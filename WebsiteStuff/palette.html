<!doctype HTML>
<html lang="en">
<head>
    <meta charset="UTF-8"> 
    <meta name="description" content="Choose your colors and blocks with the filter to generate the perfect palette for your build!">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Builders Block - Palettes</title> 
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="container">
        <header>
            <h1>Palettes</h1>
            <nav>
                <ul class="nav">
                    <li><a href="index.html">Builders Block</a></li>
                    <li><a href="palette.html" class="active">Palettes</a></li>
                    <li><a href="circle_gen.html">Circle Generator</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <p class="p-ex">Choose your colors and blocks with the filter to generate the perfect palette for your build!</p>
            <div class="color-picker-container">
                <label for="color-picker">Select a color:</label>
                <input type="color" id="color-picker" name="color-picker" value="#ff0000">
                <p id="color-value">Selected color: #ff0000</p>
            </div>
        </main>
        <button type="button" id="test-Palette-button">generate palette</button>

    </div>
    <script src="./ColorMatch.js" type="module"></script>
    <script src="./CSVparse.js" type="module"></script>
    <script type="module">
        import { MatchColor } from './ColorMatch.js';
        import { parse } from './CSVparse.js';
        const colorPicker = document.getElementById('color-picker');
        const colorValue = document.getElementById('color-value');
        const testPaletteButton = document.getElementById('test-Palette-button');
        const csv = await parse();
        var paletteSize = 6;
        colorPicker.addEventListener('input', function() {
            const selectedColor = this.value;
            colorValue.textContent = `Selected color: ${selectedColor}`;
            console.log('Selected color:', selectedColor);
        });

        testPaletteButton.addEventListener('click', function() {
            console.log("Button clicked");
            var loopNumber = 0
            var palette = [];
            var inPalette = false;
            var baseRange = 0.01;
            while(palette.length < paletteSize) {
                loopNumber++;
                if(loopNumber > 1000){
                    console.log("Loop limit reached");
                    break;
                }
                inPalette = false;
                for(var i = 0; i < csv.length; i++) {
                    if(MatchColor("#"+csv[i][1], colorPicker.value,baseRange)) {
                        //console.log("Match found: " + csv[i][0]);
                        for(var j = 0; j < palette.length; j++){
                            if(palette[j] == csv[i][0]){
                                inPalette = true;
                                break;
                            }
                        }
                        if(inPalette == false) {
                            palette.push(csv[i][0]);
                        }
                    }  
                }
            baseRange += 0.02*loopNumber;
        }
            //print paletteSize random blocks from the palette and remove
            var randomBlocks = [];
            for(var i = 0; i < paletteSize; i++) {
                var randomIndex = Math.floor(Math.random() * palette.length);
                randomBlocks.push(palette[randomIndex]);
                palette.splice(randomIndex, 1);
            }
            console.log("Random blocks: " + randomBlocks);
        });
    </script>
</body>
</html>
